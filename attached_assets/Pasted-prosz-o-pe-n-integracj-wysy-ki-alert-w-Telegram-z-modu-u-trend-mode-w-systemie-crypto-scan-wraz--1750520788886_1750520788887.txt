proszÄ™ o peÅ‚nÄ… integracjÄ™ wysyÅ‚ki alertÃ³w Telegram z moduÅ‚u trend-mode w systemie crypto-scan, wraz z informacjÄ… o koÅ„cowym scoringu (final_score).
Chcemy, aby po wykryciu momentu doÅ‚Ä…czenia do trendu przez funkcjÄ™ interpret_market_as_trader(), system automatycznie wysyÅ‚aÅ‚ bogaty alert na Telegrama z reasoningiem, confidence i scorem.

âœ… 1. Dane wejÅ›ciowe z trend_mode.py
Funkcja interpret_market_as_trader(symbol, candles, utc_hour) zwraca sÅ‚ownik:

python
Kopiuj
Edytuj
{
  "decision": "join_trend",
  "confidence": 0.84,
  "final_score": 0.82,
  "reasons": [
      "support held",
      "clean pullback",
      "momentum intact"
  ],
  "gpt_feedback": {
    "gpt_decision": "Yes â€“ ideal entry",
    "explanation": "Pullback to EMA21 held with bullish wick"
  }
}
âœ… 2. Generowanie treÅ›ci alertu
W crypto_scan_service.py, gdy decyzja to "join_trend" i final_score >= 0.75, naleÅ¼y zbudowaÄ‡ wiadomoÅ›Ä‡:

python
Kopiuj
Edytuj
alert_text = f"""
ğŸ“ˆ [Trend Mode Alert] {symbol}
âœ… Trader AI Decision: JOIN TREND
ğŸ§  Reasons:
- {'\n- '.join(trend_result['reasons'])}

ğŸ“Š Final Score: {trend_result['final_score']:.2f}
ğŸ¯ Confidence: {trend_result['confidence']*100:.1f}%
"""

if "gpt_feedback" in trend_result:
    alert_text += f"""
ğŸ¤– GPT: {trend_result['gpt_feedback']['gpt_decision']}
ğŸ“ {trend_result['gpt_feedback']['gpt_explanation']}
"""
âœ… 3. WysyÅ‚ka wiadomoÅ›ci na Telegram
JeÅ›li nie ma jeszcze takiej funkcji â€“ proszÄ™ o stworzenie send_telegram_message(msg: str) w utils/telegram.py, np.:

python
Kopiuj
Edytuj
import requests, os

def send_telegram_message(message: str):
    token = os.getenv("TELEGRAM_BOT_TOKEN")
    chat_id = os.getenv("TELEGRAM_CHANNEL_ID")
    url = f"https://api.telegram.org/bot{token}/sendMessage"
    data = {
        "chat_id": chat_id,
        "text": message,
        "parse_mode": "Markdown"
    }
    requests.post(url, data=data)
âœ… 4. Warunek alertu + wywoÅ‚anie:
W gÅ‚Ã³wnej pÄ™tli:

python
Kopiuj
Edytuj
if trend_result["decision"] == "join_trend" and trend_result["final_score"] >= 0.75:
    send_telegram_message(alert_text)
âœ… 5. (Opcjonalnie) ProszÄ™ o dodanie prostego cooldown systemu, np. already_alerted_recently(symbol, "trend_mode"), Å¼eby nie spamowaÄ‡ Telegrama przy kaÅ¼dym przebiegu.

âœ… Celem koÅ„cowym jest otrzymywanie na Telegramie inteligentnych alertÃ³w:

z informacjÄ… o symbolu

decyzjÄ… tradera

reasoningiem (why)

scoringiem (final_score)

confidence

GPT feedbackiem (jeÅ›li dostÄ™pny)

DziÄ™ki! ğŸš€

