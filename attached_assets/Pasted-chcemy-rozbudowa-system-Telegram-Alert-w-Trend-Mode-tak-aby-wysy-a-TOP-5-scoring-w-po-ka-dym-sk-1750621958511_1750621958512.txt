chcemy rozbudowaÄ‡ system Telegram Alert w Trend Mode, tak aby:

wysyÅ‚aÅ‚ TOP 5 scoringÃ³w po kaÅ¼dym skanie,

dodawaÅ‚ informacje o zmianach wag scoringu dokonanych przez feedback loop,

zawieraÅ‚ powody, dlaczego waga zostaÅ‚a zmodyfikowana (np. "pullback_quality zwiÄ™kszono, bo PAXG miaÅ‚ silny pullback, ale nie przeszedÅ‚ progu").

PoniÅ¼ej podajemy aktualizacje kodu.

1. ğŸ”§ feedback_loop_v2.py: dodaj przechwytywanie powodÃ³w zmian wag
python
Kopiuj
Edytuj
weight_update_explanations = {
    "pullback_quality": "ZwiÄ™kszono, bo missed alert na PAXG zawieraÅ‚ czysty pullback",
    "trend_strength": "Zmniejszono, bo AAVE miaÅ‚ wysoki trend score, ale byÅ‚ false positive",
    "support_reaction": "ZwiÄ™kszono â€“ dobre reakcje w poprawnych alertach (np. PEPE)"
}
2. ğŸ“Š telegram_bot.py: nowa funkcja do generowania peÅ‚nej informacji:
python
Kopiuj
Edytuj
def get_feedback_summary_with_reasons(weights_before: dict, weights_after: dict, reasons: dict) -> str:
    summary_lines = []
    for key in weights_after:
        before = weights_before.get(key, 0)
        after = weights_after[key]
        delta = after - before
        if abs(delta) >= 0.01:
            arrow = "ğŸ”¼" if delta > 0 else "ğŸ”½"
            reason = reasons.get(key, "Brak powodu.")
            summary_lines.append(
                f"- {arrow} *{key}*: {before:.2f} â†’ {after:.2f}\n   _PowÃ³d_: {reason}"
            )
    if summary_lines:
        header = f"\nğŸ“Š *Feedback loop â€“ aktualizacja wag* ({datetime.utcnow().strftime('%Y-%m-%d %H:%M UTC')}):"
        return header + "\n" + "\n".join(summary_lines)
    return ""
3. ğŸ“¬ UÅ¼ycie:
python
Kopiuj
Edytuj
feedback_summary = get_feedback_summary_with_reasons(
    weights_before,
    weights_after,
    weight_update_explanations
)
send_trend_alert(..., feedback_summary=feedback_summary)
ğŸŸ¢ Efekt koÅ„cowy w Telegramie:
vbnet
Kopiuj
Edytuj
ğŸ“Š Feedback loop â€“ aktualizacja wag (2025-06-22 18:30 UTC):

- ğŸ”¼ pullback_quality: 0.18 â†’ 0.22  
   _PowÃ³d_: ZwiÄ™kszono, bo missed alert na PAXG zawieraÅ‚ czysty pullback

- ğŸ”½ trend_strength: 0.25 â†’ 0.18  
   _PowÃ³d_: Zmniejszono, bo AAVE miaÅ‚ wysoki trend score, ale byÅ‚ false positive
âœ… To wszystko jest w peÅ‚ni kompatybilne z TJDE i alertami po skanie.