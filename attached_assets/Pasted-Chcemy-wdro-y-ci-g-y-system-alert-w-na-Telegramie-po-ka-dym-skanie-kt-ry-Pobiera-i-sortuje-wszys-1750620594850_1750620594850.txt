Chcemy wdroÅ¼yÄ‡ ciÄ…gÅ‚y system alertÃ³w na Telegramie po kaÅ¼dym skanie, ktÃ³ry:

Pobiera i sortuje wszystkie wyniki simulate_trader_decision_advanced()

Wybiera Top 5 tokenÃ³w wg final_score

WysyÅ‚a formatowany alert na Telegrama zawierajÄ…cy:

Symbol

Final Score + Confidence

Grade

Decision

KaÅ¼dy skÅ‚adnik score (trend_strength, pullback_quality, itd.)

KrÃ³tkie uzasadnienie decyzji

ğŸ“¦ Wymagane zmiany:
ğŸ” 1. W pliku skanera (np. crypto_scan_service.py):
Po zakoÅ„czeniu jednego cyklu skanu:

python
Kopiuj
Edytuj
from utils.trend_summary import send_top_trendmode_alerts_to_telegram

# all_results â†’ lista wynikÃ³w TJDE z simulate_trader_decision_advanced()
send_top_trendmode_alerts_to_telegram(all_results)
ğŸ§  2. Nowy plik: utils/trend_summary.py
python
Kopiuj
Edytuj
from utils.telegram_bot import send_trend_alert
from operator import itemgetter

def send_top_trendmode_alerts_to_telegram(results, top_n=5):
    sorted_results = sorted(results, key=itemgetter("final_score"), reverse=True)
    top_results = sorted_results[:top_n]

    for res in top_results:
        symbol = res.get("symbol")
        score = res.get("final_score", 0.0)
        confidence = res.get("confidence", 0.0)
        grade = res.get("grade", "N/A")
        decision = res.get("decision", "N/A")
        breakdown = res.get("score_breakdown", {})
        reasons = res.get("decision_reasons", [])

        text = f"""ğŸš€ *Trend-Mode Alert* [{symbol}]
ğŸ”¹ *Score:* `{score:.3f}` | *Confidence:* `{confidence:.3f}`
ğŸ”¹ *Grade:* `{grade}` | *Decision:* `{decision}`

ğŸ§  *Score Breakdown:*
{chr(10).join([f"â€¢ {k}: {v:.3f}" for k, v in breakdown.items()])}

ğŸ’¡ *Reasons:*
{chr(10).join([f"â†’ {r}" for r in reasons])}
"""
        send_trend_alert(text)
ğŸ“® 3. W utils/telegram_bot.py:
Upewnij siÄ™, Å¼e masz funkcjÄ™:

python
Kopiuj
Edytuj
def send_trend_alert(message):
    import requests
    import os

    token = os.getenv("TELEGRAM_BOT_TOKEN")
    chat_id = os.getenv("TELEGRAM_TREND_CHAT_ID")

    payload = {
        "chat_id": chat_id,
        "text": message,
        "parse_mode": "Markdown"
    }

    try:
        requests.post(f"https://api.telegram.org/bot{token}/sendMessage", data=payload)
    except Exception as e:
        print(f"âŒ Telegram error: {e}")
