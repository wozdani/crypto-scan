CzeÅ›Ä‡! ProszÄ™ o peÅ‚ne zastÄ…pienie dotychczasowego detektora trendu w trend_mode_pipeline.py nowÄ… wersjÄ… opartÄ… na:

analizie Å›wiec 15M tylko z ostatnich 3h (12 Å›wiec),

analizie poziomÃ³w wsparcia/oporu z historycznych Å›wiec (3â€“24h wstecz),

wejÅ›ciu na 5M po korekcie i sygnale bidÃ³w (entry after correction).

ðŸ§  Nowy system dziaÅ‚a tak:
1. is_strong_recent_trend(prices_15m_recent: list[float]) -> bool
Ocena rytmu tylko z ostatnich 3h (12 Å›wiec):

python
Kopiuj
Edytuj
def is_strong_recent_trend(prices_15m_recent):
    if len(prices_15m_recent) < 6:
        return False
    up_ratio = sum(1 for i in range(1, len(prices_15m_recent)) if prices_15m_recent[i] > prices_15m_recent[i-1]) / (len(prices_15m_recent) - 1)
    return up_ratio >= 0.6 and prices_15m_recent[-1] > prices_15m_recent[0]
2. find_support_resistance_levels(prices_15m_history)
Identyfikacja poziomÃ³w z danych 3â€“24h wstecz:

python
Kopiuj
Edytuj
def find_support_resistance_levels(prices_15m_history, tolerance=0.003):
    levels = []
    for i in range(2, len(prices_15m_history) - 2):
        pivot_high = prices_15m_history[i] > prices_15m_history[i-1] and prices_15m_history[i] > prices_15m_history[i+1]
        pivot_low = prices_15m_history[i] < prices_15m_history[i-1] and prices_15m_history[i] < prices_15m_history[i+1]
        if pivot_high or pivot_low:
            level = prices_15m_history[i]
            if not any(abs(level - l) / l < tolerance for l in levels):
                levels.append(level)
    return sorted(levels)
3. is_price_near_support(current_price, levels)
Sprawdza, czy obecna cena testuje poziom wsparcia:

python
Kopiuj
Edytuj
def is_price_near_support(current_price, levels, margin=0.002):
    supports = [l for l in levels if l < current_price]
    return any(abs(current_price - s) / s < margin for s in supports)
ðŸ” Logika Å‚Ä…czenia:
python
Kopiuj
Edytuj
if is_strong_recent_trend(prices_15m_recent) and is_price_near_support(current_price, support_levels):
    if is_entry_after_correction(prices_5m, ask_vols, bid_vols):
        return {
            "trend_mode": True,
            "trend_score": 100,
            "entry_triggered": True
        }
ðŸ” Dane wymagane:
prices_15m_recent: ostatnie 12 Å›wiec 15M (3h)

prices_15m_history: Å›wiece z przedziaÅ‚u 3â€“24h (84 Å›wiece)

prices_5m: ostatnie 12 Å›wiec 5M (1h)

ask_vols, bid_vols: z orderbooku

current_price: z tickera Bybit

ProszÄ™ o peÅ‚ne zastÄ…pienie starego trend score tym podejÅ›ciem oraz integracjÄ™ z scan_cycle() jako osobny alert "trend_mode".