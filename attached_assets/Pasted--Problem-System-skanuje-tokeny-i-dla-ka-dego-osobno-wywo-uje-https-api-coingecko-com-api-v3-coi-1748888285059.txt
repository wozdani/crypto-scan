ğŸ”§ Problem:
System skanuje tokeny i dla kaÅ¼dego osobno wywoÅ‚uje https://api.coingecko.com/api/v3/coins/{id}, co bardzo szybko prowadzi do bÅ‚Ä™du CoinGecko API error 429 (rate limit exceeded).
To spowalnia skanowanie i powoduje utratÄ™ danych (brak kontraktÃ³w, brak PPWCS).

ğŸ› ï¸ Cel:
ZminimalizowaÄ‡ liczbÄ™ zapytaÅ„ do CoinGecko API przez:

Jednorazowe pobranie peÅ‚nej listy tokenÃ³w (/coins/list)

Zbudowanie lokalnej mapy {symbol: id}

WysyÅ‚anie zapytaÅ„ /coins/{id} tylko gdy symbol znajduje siÄ™ na liÅ›cie i tylko raz na symbol (cache)

ğŸ“¦ Propozycja implementacji (Python):

python
Kopiuj
Edytuj
import requests
import json
import time

# Cache dla symbol -> coingecko_id
coingecko_symbol_map = {}

def load_coingecko_symbol_map():
    global coingecko_symbol_map
    try:
        response = requests.get("https://api.coingecko.com/api/v3/coins/list", timeout=10)
        if response.status_code == 200:
            data = response.json()
            # Tworzymy mapÄ™ symbol -> id, np. {"PEPEUSDT": "pepe", ...}
            coingecko_symbol_map = {
                f"{item['symbol'].upper()}USDT": item["id"]
                for item in data
            }
            print(f"âœ… ZaÅ‚adowano {len(coingecko_symbol_map)} tokenÃ³w z CoinGecko")
        else:
            print(f"âŒ BÅ‚Ä…d Å‚adowania listy CoinGecko: {response.status_code}")
    except Exception as e:
        print(f"âŒ WyjÄ…tek podczas Å‚adowania listy CoinGecko: {e}")

def get_token_contract_from_coingecko(symbol):
    if not coingecko_symbol_map:
        load_coingecko_symbol_map()

    coingecko_id = coingecko_symbol_map.get(symbol)
    if not coingecko_id:
        print(f"âš ï¸ Brak CoinGecko ID dla {symbol}")
        return None

    try:
        url = f"https://api.coingecko.com/api/v3/coins/{coingecko_id}"
        response = requests.get(url, timeout=10)
        if response.status_code == 200:
            data = response.json()
            platforms = data.get("platforms", {})
            for chain, address in platforms.items():
                if address:
                    return {
                        "chain": chain.lower(),
                        "address": address
                    }
        else:
            print(f"âš ï¸ CoinGecko API error {response.status_code} for {symbol}")
    except Exception as e:
        print(f"âŒ CoinGecko exception for {symbol}: {e}")

    return None
âœ… KorzyÅ›ci po wdroÅ¼eniu:

Zamiast kilkudziesiÄ™ciu lub setek zapytaÅ„ â€“ tylko 1 duÅ¼e zapytanie + kilka konkretnych

Brak bÅ‚Ä™dÃ³w 429 i wiÄ™ksza stabilnoÅ›Ä‡

Szybsze skanowanie

Nie trzeba wycinaÄ‡ tokenÃ³w z listy tylko dlatego, Å¼e nie majÄ… kontraktu â€“ system sam ich pominie, ale bez bÅ‚Ä™du

ProszÄ™ o pomoc z wdroÅ¼eniem powyÅ¼szej logiki do projektu crypto_scan_service.py. MoÅ¼na zintegrowaÄ‡ load_coingecko_symbol_map() przy starcie skanowania, a get_token_contract_from_coingecko() juÅ¼ jest w systemie i wymaga tylko aktualizacji zgodnie z powyÅ¼szÄ… wersjÄ….

DziÄ™ki!